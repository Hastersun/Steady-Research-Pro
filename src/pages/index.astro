---
import '../styles/global.css'
import ResearchAgentUI from '../components/ResearchAgentUI.astro'
import AIServiceSelector from '../components/AIServiceSelector.astro'
import SearchConfigPanel from '../components/SearchConfigPanel.astro'
import LanguageSwitcher from '../components/LanguageSwitcher.astro'
import i18nModuleUrl from '../lib/i18n.js?url'

---

<!DOCTYPE html>
<html lang="zh-CN" class="h-full">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title data-i18n="layout.title">Steady Research Pro</title>
		<meta name="description" content="Deep Research Agent - 多源聚合智能研究界面" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
		<script>
			(() => {
				try {
					const stored = localStorage.getItem('steady-research-pro:locale');
					if (stored) {
						document.documentElement.setAttribute('lang', stored);
						document.documentElement.dataset.locale = stored;
					}
				} catch (error) {
					console.warn('[i18n] unable to preload locale', error);
				}
			})();
		</script>
		<script type="module" src={i18nModuleUrl}></script>
	</head>
	<body class="min-h-screen text-slate-100 antialiased">
		<div class="flex min-h-screen">
			<aside class="relative w-80 flex-shrink-0 bg-slate-950/70 border-r border-white/5 px-7 py-10 backdrop-blur-2xl">
				<div class="absolute inset-y-10 right-0 w-px bg-gradient-to-b from-transparent via-white/20 to-transparent opacity-60"></div>
				<div class="space-y-9">
					<div class="space-y-3">
						<span class="badge-soft" data-i18n="layout.researchControlBadge">Research Control</span>
						<div>
							<h1 class="text-2xl font-semibold text-white tracking-tight" data-i18n="layout.title">Steady Research Pro</h1>
							<p class="text-sm text-slate-400/90 mt-1" data-i18n="layout.subtitle">Deep Research Agent Suite</p>
						</div>
					</div>
					<div class="glass-card glass-card--muted rounded-2xl px-4 py-5 text-[11px] leading-5 text-slate-300/90">
						<p class="font-semibold text-slate-100/90" data-i18n="layout.quickTipTitle">实时保持研究上下文</p>
						<p class="mt-1 text-slate-300/80" data-i18n="layout.quickTipDescription">在 Settings 中配置模型后，可一次完成规划、搜索、聚合与总结。</p>
						<div class="subtle-divider my-4"></div>
						<div class="flex items-center justify-between text-[10px] uppercase tracking-[0.18em] text-slate-500">
							<span data-i18n="layout.betaVersion">Beta build 0.3.2</span>
							<span data-i18n="layout.betaYear">2025</span>
						</div>
					</div>
					<LanguageSwitcher />
					<nav class="space-y-2">
						<button type="button" class="sidebar-link" data-target="research">
							<span class="indicator"></span>
							<span class="icon-wrap" aria-hidden="true">
								<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 7l9-4 9 4-9 4-9-4v10l9 4 9-4V7"/></svg>
							</span>
							<span class="label">
								<span class="text" data-i18n="navigation.research">Research 仪表盘</span>
								<span class="hint" data-i18n="navigation.researchHint">Agent workflow</span>
							</span>
							<span class="kbd">R</span>
						</button>
						<button type="button" class="sidebar-link" data-target="settings">
							<span class="indicator"></span>
							<span class="icon-wrap" aria-hidden="true">
								<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="1.6" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3a1.5 1.5 0 012.5 0l.61.93a1.5 1.5 0 001.28.67h1.12a1.5 1.5 0 011.41 2.06l-.44 1.2a1.5 1.5 0 000 .98l.44 1.2a1.5 1.5 0 01-1.41 2.06h-1.12a1.5 1.5 0 00-1.28.67l-.61.93a1.5 1.5 0 01-2.5 0l-.61-.93a1.5 1.5 0 00-1.28-.67H6.75a1.5 1.5 0 01-1.41-2.06l.44-1.2a1.5 1.5 0 000-.98l-.44-1.2A1.5 1.5 0 016.75 5.6h1.12a1.5 1.5 0 001.28-.67l.6-.93z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
							</span>
							<span class="label">
								<span class="text" data-i18n="navigation.settings">Settings 设置</span>
								<span class="hint" data-i18n="navigation.settingsHint">Providers &amp; 搜索</span>
							</span>
							<span class="kbd">S</span>
						</button>
					</nav>
				</div>
			</aside>
			<main class="relative flex-1 overflow-hidden">
				<div class="absolute inset-0">
					<div class="visual-grid-overlay"></div>
					<div class="floating-noise"></div>
					<div class="absolute -top-28 -left-40 h-[26rem] w-[26rem] rounded-full bg-emerald-500/20 blur-[140px]"></div>
					<div class="absolute top-40 -right-24 h-[22rem] w-[22rem] rounded-full bg-indigo-500/20 blur-[160px]"></div>
				</div>
				<div class="relative z-10">
					<div class="max-w-6xl mx-auto px-8 py-12 space-y-12">
						<header class="space-y-4">
							<div class="flex flex-wrap items-center gap-3">
								<span class="badge-soft" data-i18n="layout.researchBadge">Multi-source intelligence</span>
								<span class="text-[11px] uppercase tracking-[0.32em] text-slate-500" data-i18n="layout.researchSse">SSE streaming ready</span>
							</div>
							<div class="flex flex-col gap-3">
								<h2 class="text-3xl font-semibold text-white tracking-tight" data-i18n="layout.researchHeadline">多源智能研究工作台</h2>
								<p class="text-sm text-slate-300/90 max-w-2xl" data-i18n="layout.researchDescription">从模型调度到搜索聚合，全程可视化研究流程。通过自定义事件驱动的 UI 外壳，实时感知研究状态。</p>
							</div>
							<div class="grid gap-4 sm:grid-cols-3">
								<div class="glass-card rounded-2xl px-4 py-5">
									<p class="text-[11px] uppercase tracking-[0.22em] text-slate-400" data-i18n="layout.researchPlannerLabel">Planner</p>
									<p class="mt-2 text-lg font-semibold text-white" data-i18n="layout.researchPlannerValue">5-stage pipeline</p>
									<p class="mt-1 text-xs text-slate-300/80" data-i18n="layout.researchPlannerHint">Plan → Search → Extract → Cluster → Synthesis</p>
								</div>
								<div class="glass-card rounded-2xl px-4 py-5">
									<p class="text-[11px] uppercase tracking-[0.22em] text-slate-400" data-i18n="layout.researchLatencyLabel">Latency</p>
									<p class="mt-2 text-lg font-semibold text-white" data-i18n="layout.researchLatencyValue">42s avg</p>
									<p class="mt-1 text-xs text-slate-300/80" data-i18n="layout.researchLatencyHint">基于最近 10 次研究的平均值</p>
								</div>
								<div class="glass-card rounded-2xl px-4 py-5">
									<p class="text-[11px] uppercase tracking-[0.22em] text-slate-400" data-i18n="layout.researchSourcesLabel">Sources</p>
									<p class="mt-2 text-lg font-semibold text-white" data-i18n="layout.researchSourcesValue">8 providers</p>
									<p class="mt-1 text-xs text-slate-300/80" data-i18n="layout.researchSourcesHint">支持本地 Ollama 与主流云端 API</p>
								</div>
							</div>
						</header>
						<section class="page-panel space-y-8" data-page="research">
							<ResearchAgentUI />
						</section>
						<section class="page-panel space-y-8 hidden" data-page="settings">
							<AIServiceSelector />
							<SearchConfigPanel />
						</section>
						<footer class="pt-6 text-center text-xs text-slate-500/80" data-i18n="layout.footer">© 2025 Steady Research Pro · Crafted with Astro &amp; Tailwind</footer>
					</div>
				</div>
			</main>
		</div>

		<script>
			// @ts-nocheck
			const activatePage = (page) => {
				const panels = document.querySelectorAll('.page-panel');
				panels.forEach((panel) => {
					panel.classList.toggle('hidden', panel.dataset.page !== page);
				});

				const links = document.querySelectorAll('.sidebar-link');
				links.forEach((link) => {
					const active = link.dataset.target === page;
					link.dataset.active = active ? 'true' : 'false';
				});
			};

			const initSidebarNav = () => {
				const links = document.querySelectorAll('.sidebar-link');
				links.forEach((link) => {
					link.addEventListener('click', () => activatePage(link.dataset.target));
				});

				activatePage('research');
			};

			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', initSidebarNav);
			} else {
				initSidebarNav();
			}
		</script>

		<style>
			.sidebar-link {
				position: relative;
				display: flex;
				align-items: center;
				gap: 14px;
				width: 100%;
				padding: 14px 18px;
				border-radius: 16px;
				border: none;
				background: rgba(15, 23, 42, 0.35);
				color: rgba(226, 232, 240, 0.82);
				font-size: 0.9rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.22s ease;
				box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05), 0 10px 30px -20px rgba(30, 64, 175, 0.35);
			}

			.sidebar-link .indicator {
				position: absolute;
				left: 10px;
				width: 6px;
				height: 32px;
				border-radius: 999px;
				background: rgba(148, 163, 184, 0.22);
				transition: inherit;
			}

			.sidebar-link .icon-wrap {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				width: 34px;
				height: 34px;
				border-radius: 12px;
				background: rgba(148, 163, 184, 0.12);
				color: rgba(226, 232, 240, 0.75);
				transition: inherit;
			}

			.sidebar-link .label {
				display: flex;
				flex-direction: column;
				gap: 2px;
				text-align: left;
			}

			.sidebar-link .label .text {
				font-size: 0.95rem;
				font-weight: 600;
				letter-spacing: -0.01em;
			}

			.sidebar-link .label .hint {
				font-size: 0.68rem;
				font-weight: 500;
				text-transform: uppercase;
				letter-spacing: 0.28em;
				color: rgba(148, 163, 184, 0.55);
			}

			.sidebar-link .kbd {
				margin-left: auto;
				font-size: 0.62rem;
				letter-spacing: 0.28em;
				text-transform: uppercase;
				padding: 4px 7px;
				border-radius: 999px;
				border: 1px solid rgba(148, 163, 184, 0.22);
				color: rgba(148, 163, 184, 0.78);
				background: rgba(15, 23, 42, 0.55);
			}

			.sidebar-link[data-active='true'] {
				background: linear-gradient(135deg, rgba(59, 130, 246, 0.28), rgba(16, 185, 129, 0.35));
				color: rgba(240, 249, 255, 0.95);
				box-shadow: inset 0 0 0 1px rgba(224, 242, 254, 0.25), 0 18px 28px -22px rgba(45, 212, 191, 0.65);
			}

			.sidebar-link[data-active='true'] .indicator {
				background: linear-gradient(180deg, rgba(94, 234, 212, 0.9), rgba(14, 165, 233, 0.8));
				box-shadow: 0 0 24px rgba(45, 212, 191, 0.45);
			}

			.sidebar-link[data-active='true'] .icon-wrap {
				color: rgba(240, 249, 255, 0.95);
				background: rgba(14, 165, 233, 0.18);
			}

			.sidebar-link[data-active='false'] .indicator {
				background: rgba(148, 163, 184, 0.18);
			}

			.sidebar-link[data-active='false'] .icon-wrap {
				background: rgba(148, 163, 184, 0.1);
			}

			.sidebar-link[data-active='false']:hover {
				transform: translateX(4px);
				background: rgba(30, 41, 59, 0.6);
				color: rgba(226, 232, 240, 0.95);
			}

			.sidebar-link[data-active='false']:hover .icon-wrap {
				background: rgba(148, 163, 184, 0.2);
				color: rgba(226, 232, 240, 0.88);
			}

			@media (max-width: 1023px) {
				aside {
					display: none;
				}
			}
		</style>
	</body>
</html>
